import{u as G,V,T as q,r as o,U as J,o as Q,G as D,b0 as X,b7 as M,b1 as Y,j as e,D as Z,t as $,v as A,x as ee,y as se,z as E,B as ae,b3 as te,aA as O}from"./index-DjcYiVW5.js";import{u as re,s as ne,g as le,F as ie,a as y,b as F,d as C,c as T,S as oe,e as ce}from"./SocialShareButtons-CqsKGW26.js";import{N as P}from"./RarityFilter-Cpt9MHN2.js";import{M as p,C as u}from"./index-Df5dC7_r.js";import"./index-Bp2U-oRL.js";import"./index-BQdT0jya.js";const w=["◊","◊◊","◊◊◊","◊◊◊◊","☆"],_e=({ownedCards:m,friendCards:h,ownCollection:v,friendAccount:n})=>{const{t}=G("trade-matches"),_=V(),W=q(),{user:g,account:l,setAccount:B}=o.useContext(J),[S,I]=o.useState(!1),[j,H]=o.useState(0),[f,U]=o.useState(2);o.useEffect(()=>{_.pathname.includes("/collection")&&_.pathname.includes("/trade")?S||I(!0):I(!1)},[_]);const k=o.useMemo(()=>Q.filter(s=>s.tradeable).map(s=>s.id),[]),b=o.useMemo(()=>{const s={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},r=h.filter(a=>a.amount_owned>((n==null?void 0:n.min_number_of_cards_to_keep)||1)),c=new Set(m.filter(a=>a.amount_owned>j).map(a=>a.card_id)),x=r.filter(a=>!c.has(a.card_id));for(const a of x){const i=D(a.card_id);i&&w.includes(i.rarity)&&k.includes(i.expansion)&&s[i.rarity].push({...i,amount_owned:a.amount_owned})}return s},[m,h,j,f]),N=o.useMemo(()=>{const s={"◊":[],"◊◊":[],"◊◊◊":[],"◊◊◊◊":[],"☆":[],"☆☆":[],"☆☆☆":[],"✵":[],"✵✵":[],"Crown Rare":[],P:[],"":[]},r=m.filter(a=>a.amount_owned>=f),c=new Set(h.filter(a=>a.amount_owned>=((n==null?void 0:n.max_number_of_cards_wanted)||1)).map(a=>a.card_id)),x=r.filter(a=>!c.has(a.card_id));for(const a of x){const i=D(a.card_id);i&&w.includes(i.rarity)&&k.includes(i.expansion)&&s[i.rarity].push({...i,amount_owned:a.amount_owned})}return s},[m,h,j,f]),K=o.useMemo(()=>w.some(s=>b[s].length>0&&N[s].length>0),[b,N]),R=X({is_active_trading:Y(),min_number_of_cards_to_keep:M.number().min(1).max(10),max_number_of_cards_wanted:M.number().min(1).max(10)}),d=re({resolver:ne(R),values:{is_active_trading:(l==null?void 0:l.is_active_trading)||!1,min_number_of_cards_to_keep:(l==null?void 0:l.min_number_of_cards_to_keep)||1,max_number_of_cards_wanted:(l==null?void 0:l.max_number_of_cards_wanted)||1}}),L=async s=>{try{const r=await te.from("accounts").upsert({email:g==null?void 0:g.user.email,username:l==null?void 0:l.username,is_active_trading:s.is_active_trading,min_number_of_cards_to_keep:s.min_number_of_cards_to_keep,max_number_of_cards_wanted:s.max_number_of_cards_wanted}).select().single();if(!r.data)throw console.error("Could not save account",l),new Error("Could not save account");B(r.data),O({title:"Account saved.",variant:"default"})}catch(r){console.error("error saving account",r),O({title:"Error saving your account.",variant:"destructive"})}},z=()=>v?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:t("ownCollection")}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("ownCollectionDescription")}),e.jsx(ie,{...d,children:e.jsx("form",{onSubmit:d.handleSubmit(L),className:"mt-8 flex justify-center",children:e.jsxs("div",{className:"border-1 border-neutral-700 p-4 space-y-2",children:[e.jsx(y,{control:d.control,name:"is_active_trading",render:({field:s})=>e.jsx(F,{className:"flex flex-col items-start",children:e.jsx(C,{children:e.jsxs("div",{className:"flex items-center gap-x-4 flex-wrap",children:[e.jsx(T,{className:"flex sm:w-72",children:t("isActiveTrading")}),e.jsx("div",{className:"grow-1",children:e.jsx(oe,{checked:s.value,onCheckedChange:s.onChange})}),e.jsx(ce,{className:"grow",children:s.value?"active":"disabled"}),e.jsx(p,{id:"activeInput",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(u,{className:"h-4 w-4","data-tooltip-id":"activeInput","data-tooltip-content":t("activeTradingInputTooltip")})]})})})}),e.jsx(y,{control:d.control,name:"min_number_of_cards_to_keep",render:({field:s})=>e.jsx(F,{className:"flex flex-col items-start",children:e.jsx(C,{children:e.jsxs("div",{className:"flex items-center gap-x-4 flex-wrap",children:[e.jsx(T,{className:"flex sm:w-72",children:t("minNumberOfCardsToKeep")}),e.jsx("div",{className:"grow-1",children:e.jsx(E,{type:"number",...s})}),e.jsx(p,{id:"minInput",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(u,{className:"h-4 w-4","data-tooltip-id":"minInput","data-tooltip-content":t("minInputTooltip")})]})})})}),e.jsx(y,{control:d.control,name:"max_number_of_cards_wanted",render:({field:s})=>e.jsx(F,{className:"flex flex-col items-start",children:e.jsx(C,{children:e.jsxs("div",{className:"flex items-center gap-x-4 flex-wrap",children:[e.jsx(T,{className:"flex sm:w-72",children:t("maxNumberOfCardsWanted")}),e.jsx("div",{className:"grow-1",children:e.jsx(E,{type:"number",...s})}),e.jsx(p,{id:"maxInput",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(u,{className:"h-4 w-4","data-tooltip-id":"maxInput","data-tooltip-content":t("maxInputTooltip")})]})})})}),e.jsx("div",{className:"w-full flex justify-end mt-8",children:e.jsx(ae,{type:"submit",children:t("save")})})]})})})]}):n!=null&&n.is_active_trading?K?w.map(s=>b[s].length>0&&N[s].length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:t("friendHas")}),e.jsx("div",{className:"border rounded p-2 max-h-60 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:b[s].map(r=>{var c;return e.jsxs("li",{className:"flex justify-between",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsxs("span",{className:"min-w-14 me-4",children:[r.card_id," "]}),e.jsx("span",{children:r.name})]}),e.jsx("span",{title:"Amount you own",className:"text-gray-500",children:e.jsxs("span",{style:{userSelect:"none"},children:["×",((c=m.find(x=>x.card_id===r.card_id))==null?void 0:c.amount_owned)||0]})})]},r.card_id)})})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:t("youHave")}),e.jsx("div",{className:"border rounded p-2 max-h-60 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:N[s].map(r=>e.jsxs("li",{className:"flex justify-between",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsxs("span",{className:"min-w-14 me-4",children:[r.card_id," "]}),e.jsx("span",{children:r.name})]}),e.jsx("span",{title:"Amount your friend owns",className:"text-gray-500",children:e.jsxs("span",{style:{userSelect:"none"},children:["×",r.amount_owned]})})]},r.card_id))})})]})]})]},s)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:t("noPossibleTrades")}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("noPossibleTradesDescription")})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-xl ",children:t("inActiveTradePage",{username:n==null?void 0:n.username})}),e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:t("inActiveTradeDescription")})]});return e.jsx(Z,{open:S,onOpenChange:s=>{s||W(_.pathname.replace("/trade",""))},children:e.jsxs($,{className:"border-1 border-neutral-700 shadow-none max-w-4xl h-[90vh] content-start flex flex-col",children:[e.jsx(A,{children:e.jsx(ee,{children:t("title")})}),e.jsxs("div",{className:"flex flex-col gap-4 grow",children:[e.jsx("p",{className:"pb-2",children:t("featureDescription")}),e.jsx("p",{className:"pb-2",children:t("friendAccountDetails",{...n})}),!v&&e.jsxs("div",{className:"flex flex-row gap-4 mb-4 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{numberFilter:j,setNumberFilter:H,options:[0,1,2,3,4,5],labelKey:"maxNum"}),e.jsx(p,{id:"minFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(u,{className:"h-4 w-4","data-tooltip-id":"minFilter","data-tooltip-content":t("minFilterTooltip")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{id:"maxFilter",style:{maxWidth:"300px",whiteSpace:"normal"},clickable:!0}),e.jsx(u,{className:"h-4 w-4","data-tooltip-id":"maxFilter","data-tooltip-content":t("maxFilterTooltip")}),e.jsx(P,{numberFilter:f,setNumberFilter:U,options:[2,3,4,5],labelKey:"minNum"})]})]}),z()]}),v&&e.jsx(se,{children:e.jsx(le,{})})]})})};export{_e as default};
